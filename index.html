<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Metadados b√°sicos -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional</title>

  <meta name="description" content="Plataforma cl√≠nica baseada na Roda das Emo√ß√µes de Plutchik para psicoeduca√ß√£o e treino de habilidades emocionais, com registro, gr√°fico, PDF e envio ao psic√≥logo.">
  <meta name="keywords" content="roda das emo√ß√µes, Plutchik, emo√ß√µes, habilidades emocionais, regula√ß√£o emocional, psicologia, terapia, TCC, DBT">
  <meta name="author" content="Richelmy Murta, Psic√≥logo Cl√≠nico">

  <!-- Ajuste a URL abaixo para o endere√ßo real do seu GitHub Pages -->
  <link rel="canonical" href="https://ricmurtapsicologia.github.io/rodaemo-oes/">

  <!-- √çcone: refer√™ncia visual da roda em formato de flor -->
  <link rel="icon" type="image/jpeg" href="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">

  <!-- Open Graph / WhatsApp -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional">
  <meta property="og:description" content="Clique na emo√ß√£o, registre a experi√™ncia, gere PDF e envie ao seu psic√≥logo. Psicoeduca√ß√£o baseada na Roda das Emo√ß√µes de Plutchik.">
  <meta property="og:url" content="https://ricmurtapsicologia.github.io/rodaemo-oes/">
  <meta property="og:image" content="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">
  <meta property="og:locale" content="pt_BR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Roda das Emo√ß√µes de Plutchik ‚Äì Treino Emocional">
  <meta name="twitter:description" content="Ferramenta interativa de treino de habilidades emocionais com registro, gr√°fico, PDF e envio ao psic√≥logo.">
  <meta name="twitter:image" content="https://i.pinimg.com/736x/78/63/71/7863710610e4f8e6850fd873cbf29dea.jpg">

  <!-- JSON-LD para SEO (WebApplication) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Roda das Emo√ß√µes de Plutchik",
    "description": "Ferramenta interativa de treino de habilidades emocionais baseada na teoria psicoevolutiva de Plutchik.",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Any",
    "author": {
      "@type": "Person",
      "name": "Richelmy Murta"
    }
  }
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <!-- jsPDF e autoTable para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>

  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-gradient: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      --bg-card: #020617;
      --border-subtle: #1f2937;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.3);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --radius-xl: 1.3rem;
      --radius-lg: 1rem;
      --radius-md: 0.75rem;
      --shadow-soft: 0 18px 48px rgba(0, 0, 0, 0.6);
      --focus-ring: 0 0 0 2px rgba(248, 250, 252, 0.28),
                     0 0 0 4px rgba(249, 115, 22, 0.7);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --stroke-wheel: #020617;
    }

    body[data-theme="light"] {
      color-scheme: light;
      --bg: #f3f4f6;
      --bg-gradient: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 45%, #e5e7eb 100%);
      --bg-card: #ffffff;
      --border-subtle: #d1d5db;
      --text-main: #111827;
      --text-muted: #374151;
      --text-soft: #4b5563;
      --shadow-soft: 0 16px 40px rgba(15, 23, 42, 0.18);
      --accent-soft: rgba(249, 115, 22, 0.15);
      --stroke-wheel: #111827;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: var(--font-main);
      background: var(--bg-gradient);
      color: var(--text-main);
      line-height: 1.5;
      display: flex;
      flex-direction: column;
    }

    [hidden] {
      display: none !important;
    }

    /* Onboarding */

    .onboarding-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15,23,42,0.96) 0, rgba(2,6,23,0.98) 50%, rgba(0,0,0,0.96) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 40;
      padding: 1rem;
    }

    body[data-theme="light"] .onboarding-overlay {
      background: radial-gradient(circle at top, rgba(243,244,246,0.98) 0, rgba(229,231,235,0.98) 50%, rgba(209,213,219,0.98) 100%);
    }

    .onboarding-dialog {
      max-width: 520px;
      width: 100%;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 1.3rem 1.4rem 1.2rem;
      color: var(--text-main);
    }

    body[data-theme="light"] .onboarding-dialog {
      background: #ffffff;
    }

    .onboarding-title {
      margin: 0 0 0.4rem;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .onboarding-subtitle {
      margin: 0 0 0.7rem;
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .onboarding-steps {
      list-style: none;
      padding: 0;
      margin: 0 0 0.9rem;
      font-size: 0.9rem;
      color: var(--text-main);
    }

    .onboarding-steps li {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.4rem;
    }

    .onboarding-bullet {
      width: 1.4rem;
      height: 1.4rem;
      border-radius: 999px;
      background: rgba(249,115,22,0.16);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: var(--accent);
      flex-shrink: 0;
    }

    .onboarding-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.4rem;
    }

    .onboarding-note {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 0.2rem;
    }

    /* Cabe√ßalho */

    .app-header {
      border-bottom: 1px solid #111827;
      padding: 0.9rem 1.5rem 0.8rem;
      background: rgba(2, 6, 23, 0.96);
      color: #e5e7eb;
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    body[data-theme="light"] .app-header {
      background: rgba(249, 250, 251, 0.96);
      border-bottom-color: #e5e7eb;
      color: #111827;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .brand {
      margin: 0 0 0.1rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
    }

    .app-title {
      margin: 0;
      font-size: 1.6rem;
      font-weight: 700;
    }

    .app-subtitle {
      margin: 0.35rem 0 0;
      font-size: 0.9rem;
      color: var(--text-muted);
      max-width: 540px;
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 0.6rem;
      margin: 0;
      padding: 0;
      font-size: 0.85rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .nav-links a {
      color: var(--text-soft);
      text-decoration: none;
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      transition: background-color 0.12s ease, color 0.12s ease;
    }

    .nav-links a:hover,
    .nav-links a:focus-visible {
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
    }

    body[data-theme="light"] .nav-links a:hover,
    body[data-theme="light"] .nav-links a:focus-visible {
      background: rgba(209, 213, 219, 0.9);
      color: #111827;
    }

    .btn-theme-toggle {
      border-radius: 999px;
      border: 1px solid #4b5563;
      padding: 0.3rem 0.6rem;
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
      cursor: pointer;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.12s ease, transform 0.08s ease;
    }

    body[data-theme="light"] .btn-theme-toggle {
      background: #e5e7eb;
      color: #111827;
      border-color: #9ca3af;
    }

    .btn-theme-toggle:hover {
      transform: translateY(-1px);
      background: #111827;
    }

    body[data-theme="light"] .btn-theme-toggle:hover {
      background: #d1d5db;
    }

    .btn-theme-toggle:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    /* Layout principal */

    .layout {
      max-width: 1200px;
      margin: 1.2rem auto 1.8rem;
      padding: 0 1.5rem;
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 1.75fr);
      grid-template-rows: auto auto;
      gap: 1.3rem;
    }

    .panel {
      background: radial-gradient(circle at top right, #111827 0, var(--bg-card) 50%, var(--bg-card) 100%);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 1.1rem 1.2rem 1.2rem;
      min-height: 0;
    }

    body[data-theme="light"] .panel {
      background: radial-gradient(circle at top right, #e5e7eb 0, #ffffff 55%, #ffffff 100%);
    }

    .panel-wheel {
      grid-row: 1 / 3;
    }

    .panel-history {
      grid-column: 1 / 3;
    }

    .panel-header {
      margin-bottom: 0.8rem;
    }

    .section-title {
      margin: 0 0 0.15rem;
      font-size: 1.15rem;
      font-weight: 600;
    }

    .section-subtitle {
      margin: 0;
      font-size: 0.86rem;
      color: var(--text-soft);
    }

    /* Roda de emo√ß√µes */

    .wheel-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.6rem 0 0.9rem;
      max-width: 560px;
      margin: 0 auto;
    }

    /* NOVO: container com aspect-ratio garante altura em mobile */
    .wheel-container {
      width: 100%;
      max-width: 480px;
      aspect-ratio: 1 / 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .emotion-wheel {
      width: 100%;
      height: 100%;
      display: block;
      min-height: 260px; /* garante que n√£o colapse em algumas telas menores */
    }

    .wheel-help {
      margin: 0.4rem 0 0;
      font-size: 0.82rem;
      color: var(--text-soft);
      text-align: center;
    }

    .wheel-segment {
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      cursor: pointer;
      transition: transform 0.12s ease, stroke-width 0.12s ease, filter 0.12s ease;
    }

    .wheel-segment:focus-visible {
      outline: none;
      stroke-width: 2;
      filter: drop-shadow(0 0 4px var(--accent-soft));
    }

    .wheel-segment.highlight {
      stroke-width: 2;
      filter: drop-shadow(0 0 4px var(--accent-soft));
      transform: scale(1.03);
    }

    .wheel-label {
      font-size: 9px;
      font-weight: 600;
      fill: var(--stroke-wheel);
      text-anchor: middle;
      pointer-events: none;
      user-select: none;
    }

    body[data-theme="dark"] .wheel-label {
      fill: #020617;
    }

    .wheel-dotted-circle {
      fill: none;
      stroke: var(--stroke-wheel);
      stroke-width: 0.8;
      stroke-dasharray: 2 3;
    }

    /* Detalhes */

    .details-card {
      background: radial-gradient(circle at top left, #111827 0, var(--bg-card) 50%);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.9rem;
      margin-bottom: 0.8rem;
      min-height: 180px;
    }

    body[data-theme="light"] .details-card {
      background: #ffffff;
      border-color: #d1d5db;
    }

    .details-placeholder {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .details-emotion-name {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0 0 0.3rem;
    }

    .details-emotion-meta {
      margin: 0 0 0.3rem;
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    .details-block {
      margin: 0.25rem 0;
      font-size: 0.9rem;
      color: var(--text-main);
    }

    .details-block strong {
      display: inline-block;
      margin-bottom: 0.05rem;
    }

    .details-list {
      margin: 0.1rem 0 0.25rem 1.1rem;
      padding: 0;
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    /* Formul√°rio */

    .emotion-form {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .form-row-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
    }

    .form-group {
      flex: 1 1 160px;
    }

    .form-label {
      display: block;
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-bottom: 0.18rem;
    }

    .form-input,
    .form-select,
    textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      color: var(--text-main);
      font-family: var(--font-main);
      font-size: 0.9rem;
    }

    body[data-theme="light"] .form-input,
    body[data-theme="light"] .form-select,
    body[data-theme="light"] textarea {
      border-color: #d1d5db;
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 220px;
    }

    textarea::placeholder,
    .form-input::placeholder {
      color: var(--text-soft);
    }

    .form-input:focus,
    .form-select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: var(--focus-ring);
    }

    .form-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
      justify-content: flex-end;
      margin-top: 0.3rem;
    }

    .btn-primary,
    .btn-secondary,
    .btn-ghost,
    .btn-text {
      border-radius: 999px;
      padding: 0.55rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background-color 0.12s ease, opacity 0.1s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0, #fb923c 50%, #facc15 100%);
      color: #111827;
      box-shadow: 0 14px 35px rgba(248, 163, 45, 0.55);
    }

    .btn-primary:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      border: 1px solid #1f2937;
    }

    body[data-theme="light"] .btn-secondary {
      background: #f3f4f6;
      border-color: #d1d5db;
      color: #111827;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px dashed #374151;
    }

    body[data-theme="light"] .btn-ghost {
      border-color: #9ca3af;
    }

    .btn-text {
      background: transparent;
      color: var(--text-soft);
      border-radius: 999px;
      border: none;
      padding: 0.25rem 0.6rem;
      font-size: 0.8rem;
    }

    .btn-primary:hover:not(:disabled),
    .btn-secondary:hover,
    .btn-ghost:hover,
    .btn-text:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.65);
    }

    .btn-primary:active:not(:disabled),
    .btn-secondary:active,
    .btn-ghost:active,
    .btn-text:active {
      transform: translateY(0);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.7);
    }

    .btn-primary:focus-visible,
    .btn-secondary:focus-visible,
    .btn-ghost:focus-visible,
    .btn-text:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .helper-text {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-top: 0.15rem;
    }

    /* Gr√°ficos e hist√≥rico */

    .charts-wrapper {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.7fr);
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .chart-card,
    .history-card {
      background: rgba(2, 6, 23, 0.96);
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      padding: 0.7rem 0.8rem;
    }

    body[data-theme="light"] .chart-card,
    body[data-theme="light"] .history-card {
      background: #ffffff;
      border-color: #d1d5db;
    }

    .history-card {
      padding-bottom: 0.9rem;
    }

    .chart-title,
    .history-title {
      margin: 0 0 0.3rem;
      font-size: 0.95rem;
    }

    .chart-helper,
    .history-help {
      margin: 0 0 0.35rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .history-table-wrapper {
      margin-top: 0.4rem;
      max-height: 260px;
      overflow: auto;
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      background: #020617;
    }

    body[data-theme="light"] .history-table-wrapper {
      background: #f9fafb;
      border-color: #d1d5db;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .history-table th,
    .history-table td {
      padding: 0.32rem 0.4rem;
      border-bottom: 1px solid rgba(31, 41, 55, 0.85);
      text-align: left;
    }

    body[data-theme="light"] .history-table th,
    body[data-theme="light"] .history-table td {
      border-bottom-color: #e5e7eb;
    }

    .history-table th {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
      font-weight: 600;
      color: var(--text-muted);
    }

    body[data-theme="light"] .history-table th {
      background: #f9fafb;
    }

    .history-table tr:last-child td {
      border-bottom: none;
    }

    .history-table td:nth-child(4) {
      max-width: 220px;
      overflow-wrap: break-word;
    }

    .history-empty {
      margin: 0.4rem 0;
      padding: 0 0.5rem 0.5rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .history-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    /* Sobre */

    .panel-about {
      margin-top: 0.2rem;
      grid-column: 1 / 3;
    }

    .about-content {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .about-content ul {
      padding-left: 1rem;
    }

    /* Rodap√© */

    .app-footer {
      margin-top: auto;
      padding: 0.9rem 1.5rem 1.1rem;
      font-size: 0.8rem;
      color: var(--text-soft);
      border-top: 1px solid #111827;
      background: radial-gradient(circle at top, rgba(15,23,42,0.9) 0, #020617 50%, #000 100%);
    }

    body[data-theme="light"] .app-footer {
      border-top-color: #e5e7eb;
      background: linear-gradient(to right, #f9fafb 0, #ffffff 40%, #f9fafb 100%);
      color: #4b5563;
    }

    .footer-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      text-align: center;
      flex-direction: column;
    }

    .footer-main {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      align-items: center;
    }

    .footer-main strong {
      font-weight: 600;
    }

    .footer-tagline {
      font-size: 0.78rem;
      opacity: 0.9;
    }

    .footer-badge {
      font-size: 0.72rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(249, 115, 22, 0.4);
      background: rgba(15, 23, 42, 0.8);
      color: #f9fafb;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      white-space: nowrap;
    }

    body[data-theme="light"] .footer-badge {
      background: #fff7ed;
      color: #9a3412;
      border-color: #fed7aa;
    }

    [role="button"],
    svg [tabindex="0"] {
      cursor: pointer;
    }

    /* Responsividade */

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }

      .panel-wheel {
        grid-row: auto;
      }

      .panel-history {
        grid-column: auto;
      }

      .header-inner {
        flex-direction: column;
        align-items: flex-start;
      }

      .nav-links {
        margin-top: 0.4rem;
        justify-content: flex-start;
      }

      .charts-wrapper {
        grid-template-columns: minmax(0, 1fr);
      }

      .wheel-wrapper {
        max-width: 520px;
      }
    }

    @media (max-width: 640px) {
      .layout {
        padding: 0 1rem;
      }

      .app-header {
        padding-inline: 1rem;
      }

      .app-footer {
        padding-inline: 1rem;
      }

      .panel {
        padding: 0.9rem;
      }

      .app-title {
        font-size: 1.35rem;
      }

      .app-subtitle {
        font-size: 0.86rem;
      }

      .header-inner {
        gap: 0.5rem;
      }

      .wheel-wrapper {
        padding-top: 0.2rem;
      }

      .wheel-container {
        max-width: 380px;
      }

      .wheel-label {
        font-size: 8px;
      }

      .footer-inner {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- Onboarding / Como usar -->
  <div
    id="onboardingOverlay"
    class="onboarding-overlay"
    role="dialog"
    aria-modal="true"
    aria-labelledby="onboardingTitle"
    aria-describedby="onboardingSubtitle"
    hidden>
    <div class="onboarding-dialog">
      <h2 id="onboardingTitle" class="onboarding-title">Como usar a Roda das Emo√ß√µes</h2>
      <p id="onboardingSubtitle" class="onboarding-subtitle">
        Esta ferramenta foi criada para te ajudar a reconhecer, entender e registrar suas emo√ß√µes de forma segura e organizada.
      </p>
      <ul class="onboarding-steps">
        <li>
          <span class="onboarding-bullet">1</span>
          <div>
            <strong>Escolha uma emo√ß√£o na roda.</strong><br>
            Clique em uma p√©tala ou combina√ß√£o para ver o nome e o significado daquela emo√ß√£o.
          </div>
        </li>
        <li>
          <span class="onboarding-bullet">2</span>
          <div>
            <strong>Leia a explica√ß√£o psicoeducativa.</strong><br>
            Veja para que serve essa emo√ß√£o, em quais situa√ß√µes costuma aparecer e quais s√£o os riscos quando ela n√£o √© bem manejada.
          </div>
        </li>
        <li>
          <span class="onboarding-bullet">3</span>
          <div>
            <strong>Registre a situa√ß√£o.</strong><br>
            Preencha o contexto, gatilhos e comportamentos. Depois, use o PDF ou o WhatsApp para conversar em sess√£o ou compartilhar com algu√©m de confian√ßa.
          </div>
        </li>
      </ul>
      <p class="onboarding-note">
        Esta ferramenta n√£o substitui servi√ßos de emerg√™ncia. Em situa√ß√µes de risco imediato, procure ajuda presencial ou ligue para servi√ßos oficiais de crise.
      </p>
      <div class="onboarding-footer">
        <button type="button" class="btn-ghost" id="onboardingLaterButton">
          Ver mais tarde
        </button>
        <button type="button" class="btn-primary" id="onboardingStartButton">
          Entendi, come√ßar
        </button>
      </div>
    </div>
  </div>

  <header class="app-header">
    <div class="header-inner">
      <div>
        <p class="brand">Atlas Emocional</p>
        <h1 class="app-title">Roda das Emo√ß√µes de Plutchik</h1>
        <p class="app-subtitle">
          Psicoeduca√ß√£o e treino de habilidades emocionais. Clique na emo√ß√£o, registre a situa√ß√£o, gere PDF e envie ao seu psic√≥logo.
        </p>
      </div>
      <nav aria-label="Navega√ß√£o principal">
        <ul class="nav-links">
          <li><a href="#sec-mapa">Mapa</a></li>
          <li><a href="#sec-registro">Registro</a></li>
          <li><a href="#sec-graficos">Hist√≥rico</a></li>
          <li><a href="#sec-sobre">Sobre</a></li>
          <li>
            <button type="button" class="btn-text" id="howToUseButton">
              Como usar
            </button>
          </li>
          <li>
            <button type="button" class="btn-theme-toggle" id="themeToggle">
              <span id="themeIcon">üåô</span>
              <span id="themeLabel">Tema escuro</span>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="layout">
    <!-- Roda -->
    <section id="sec-mapa" class="panel panel-wheel" aria-labelledby="titulo-mapa">
      <header class="panel-header">
        <h2 id="titulo-mapa" class="section-title">Mapa emocional interativo</h2>
        <p class="section-subtitle">
          Baseado na Roda das Emo√ß√µes de Plutchik: 8 emo√ß√µes b√°sicas, 3 intensidades e 8 combina√ß√µes entre elas.
        </p>
      </header>

      <div class="wheel-wrapper" aria-live="polite">
        <!-- NOVO: container para garantir propor√ß√£o e altura -->
        <div class="wheel-container">
          <svg
            id="emotionWheel"
            class="emotion-wheel"
            viewBox="-190 -190 380 380"
            role="img"
            aria-label="Roda das Emo√ß√µes de Plutchik com intensidades e combina√ß√µes">
          </svg>
        </div>
        <p class="wheel-help">
          Clique em qualquer p√©tala ou combina√ß√£o para explorar a emo√ß√£o e registrar sua experi√™ncia.
        </p>
      </div>
    </section>

    <!-- Detalhes e registro -->
    <section id="sec-registro" class="panel panel-details" aria-labelledby="titulo-detalhes">
      <header class="panel-header">
        <h2 id="titulo-detalhes" class="section-title">Detalhes da emo√ß√£o e registro cl√≠nico</h2>
        <p class="section-subtitle">
          Nomeie o que sente, entenda a fun√ß√£o da emo√ß√£o e registre o contexto para trabalhar em sess√£o.
        </p>
      </header>

      <article class="details-card" id="detailsCard" aria-live="polite">
        <p class="details-placeholder">
          Nenhuma emo√ß√£o foi selecionada ainda.
          Use a roda ao lado para escolher uma emo√ß√£o ou combina√ß√£o e ver orienta√ß√µes psicoeducativas.
        </p>
      </article>

      <form class="emotion-form" id="emotionForm">
        <div class="form-row-inline">
          <div class="form-group">
            <label for="patientName" class="form-label">Nome do paciente</label>
            <input id="patientName" class="form-input" type="text" placeholder="Digite o nome do paciente">
          </div>
          <div class="form-group" style="max-width:110px;">
            <label for="patientAge" class="form-label">Idade</label>
            <input id="patientAge" class="form-input" type="number" min="0" max="120" placeholder="Anos">
          </div>
          <div class="form-group" style="max-width:170px;">
            <label for="recordDate" class="form-label">Data de refer√™ncia</label>
            <input id="recordDate" class="form-input" type="date">
          </div>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="selectedEmotion" class="form-label">Emo√ß√£o selecionada</label>
            <input id="selectedEmotion" class="form-input" type="text" placeholder="Clique em uma p√©tala na roda (pode editar o nome se desejar)">
          </div>
          <div class="form-group">
            <label for="userIntensity" class="form-label">Intensidade percebida</label>
            <select id="userIntensity" class="form-select">
              <option value="leve">Leve</option>
              <option value="moderada" selected>Moderada</option>
              <option value="intensa">Intensa</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="contextInput" class="form-label">Contexto emocional</label>
          <textarea id="contextInput" placeholder="O que aconteceu? Onde voc√™ estava? Com quem?"></textarea>
        </div>

        <div class="form-row-inline">
          <div class="form-group">
            <label for="triggersInput" class="form-label">Gatilhos percebidos</label>
            <textarea id="triggersInput" placeholder="Palavras, imagens, situa√ß√µes ou pensamentos que parecem ativar essa emo√ß√£o."></textarea>
          </div>
          <div class="form-group">
            <label for="behaviorsInput" class="form-label">O que voc√™ fez</label>
            <textarea id="behaviorsInput" placeholder="Como voc√™ reagiu? O que fez ou deixou de fazer?"></textarea>
          </div>
        </div>

        <div class="form-group">
          <label for="desiredInput" class="form-label">Como gostaria de ter reagido</label>
          <textarea id="desiredInput" placeholder="Qual seria uma resposta mais alinhada com seus valores e objetivos?"></textarea>
        </div>

        <p class="helper-text">
          Este registro √© guardado apenas neste dispositivo. Voc√™ pode gerar um PDF ou enviar um resumo pelo WhatsApp
          para conversar em sess√£o. Em caso de urg√™ncia ou risco imediato, procure servi√ßos de emerg√™ncia presenciais.
        </p>

        <div class="form-actions">
          <button type="button" class="btn-ghost" id="shareWhatsappButton">
            Compartilhar registro via WhatsApp
          </button>
          <button type="button" class="btn-ghost" id="sharePageButton">
            Compartilhar p√°gina (WhatsApp)
          </button>
          <button type="button" class="btn-secondary" id="sendPsychologistWhatsappButton">
            Falar com meu psic√≥logo
          </button>
          <button type="button" class="btn-secondary" id="downloadPdfButton">
            Baixar PDF do meu registro
          </button>
          <button type="submit" class="btn-primary" id="registerButton" disabled>
            Registrar emo√ß√£o
          </button>
        </div>
      </form>
    </section>

    <!-- Hist√≥rico e gr√°ficos -->
    <section id="sec-graficos" class="panel panel-history" aria-labelledby="titulo-graficos">
      <header class="panel-header">
        <h2 id="titulo-graficos" class="section-title">Hist√≥rico emocional e gr√°fico</h2>
        <p class="section-subtitle">
          Use o hist√≥rico para observar padr√µes e planejar, junto com o psic√≥logo, novas estrat√©gias de cuidado.
        </p>
      </header>

      <div class="charts-wrapper">
        <article class="chart-card" aria-label="Gr√°fico de frequ√™ncia por emo√ß√£o prim√°ria">
          <h3 class="chart-title">Frequ√™ncia das emo√ß√µes b√°sicas</h3>
          <p class="chart-helper">
            Cada barra representa quantas vezes cada emo√ß√£o prim√°ria foi registrada neste navegador
            (diades contam para as duas emo√ß√µes envolvidas, com peso 0,5 para cada uma).
          </p>
          <div style="height:220px;">
            <canvas id="emotionChart" aria-label="Gr√°fico de barras de frequ√™ncia emocional" role="img"></canvas>
          </div>
        </article>

        <article class="history-card" aria-label="Hist√≥rico de registros emocionais">
          <h3 class="history-title">Hist√≥rico de registros</h3>
          <p class="history-help">
            Os dados ficam salvos apenas neste dispositivo atrav√©s do armazenamento local. Voc√™ pode apag√°-los quando desejar.
          </p>

          <div class="history-table-wrapper">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Data e hora</th>
                  <th>Emo√ß√£o</th>
                  <th>Intensidade</th>
                  <th>Contexto</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
            <p id="historyEmptyMessage" class="history-empty">
              Nenhum registro ainda. Use o formul√°rio acima para registrar sua primeira emo√ß√£o.
            </p>
          </div>

          <div class="history-actions">
            <button type="button" class="btn-secondary" id="clearHistoryButton">
              Limpar hist√≥rico
            </button>
          </div>
        </article>
      </div>
    </section>

    <!-- Sobre -->
    <section id="sec-sobre" class="panel panel-about" aria-labelledby="titulo-sobre">
      <header class="panel-header">
        <h2 id="titulo-sobre" class="section-title">Sobre esta ferramenta</h2>
      </header>
      <article class="about-content">
        <p>
          A Roda das Emo√ß√µes de Plutchik organiza oito emo√ß√µes b√°sicas em diferentes intensidades e combina√ß√µes.
          Esta ferramenta foi adaptada para uso psicoeducativo e cl√≠nico, ajudando na identifica√ß√£o, nomea√ß√£o e
          regula√ß√£o das emo√ß√µes no dia a dia.
        </p>
        <p>
          O objetivo principal √© treinar tr√™s habilidades:
        </p>
        <ul>
          <li>Perceber o que voc√™ est√° sentindo com mais precis√£o.</li>
          <li>Compreender a fun√ß√£o da emo√ß√£o em vez de apenas julg√°-la como boa ou ruim.</li>
          <li>Planejar respostas mais compat√≠veis com seus valores e metas de vida.</li>
        </ul>
        <p>
          Esta ferramenta n√£o substitui psicoterapia ou atendimento m√©dico. √â um recurso de apoio
          para ser usado em conjunto com acompanhamento profissional.
        </p>
      </article>
    </section>
  </main>

  <footer class="app-footer">
    <div class="footer-inner">
      <div class="footer-main">
        <p>
          <strong>Richelmy Murta ‚Äì Psic√≥logo Cl√≠nico</strong>
        </p>
        <p class="footer-tagline">
          Ferramenta de psicoeduca√ß√£o baseada na Roda das Emo√ß√µes de Plutchik. Uso cl√≠nico e educativo respons√°vel.
        </p>
        <p class="footer-tagline">
          ¬© <span id="footerYear"></span>. Registros armazenados apenas neste dispositivo.
        </p>
      </div>
      <div>
        <span class="footer-badge">
          üß† Treino de Habilidades Emocionais
        </span>
      </div>
    </div>
  </footer>

  <script>
    "use strict";

    const PRIMARIES = [
      { key: "joy", label: "Alegria", angle: -90,    colors: "#ffd54a" },
      { key: "trust", label: "Confian√ßa", angle: -45, colors: "#b7f96a" },
      { key: "fear", label: "Medo", angle: 0,        colors: "#4caf50" },
      { key: "surprise", label: "Surpresa", angle: 45,  colors: "#4fc3f7" },
      { key: "sadness", label: "Tristeza", angle: 90,   colors: "#5c6bc0" },
      { key: "disgust", label: "Nojo", angle: 135,   colors: "#ba68c8" },
      { key: "anger", label: "Raiva", angle: 180,   colors: "#ff5252" },
      { key: "anticipation", label: "Antecipa√ß√£o", angle: 225, colors: "#ff9800" }
    ];

    const INTENSITY_CONFIG = {
      joy: [
        { code: "joy_high",   label: "√äxtase",      ring: "high" },
        { code: "joy_mid",    label: "Alegria",     ring: "mid" },
        { code: "joy_low",    label: "Serenidade",  ring: "low" }
      ],
      trust: [
        { code: "trust_high", label: "Admira√ß√£o",   ring: "high" },
        { code: "trust_mid",  label: "Confian√ßa",   ring: "mid" },
        { code: "trust_low",  label: "Aprova√ß√£o",   ring: "low" }
      ],
      fear: [
        { code: "fear_high",  label: "Terror",      ring: "high" },
        { code: "fear_mid",   label: "Medo",        ring: "mid" },
        { code: "fear_low",   label: "Apreens√£o",   ring: "low" }
      ],
      surprise: [
        { code: "surprise_high", label: "Assombro",    ring: "high" },
        { code: "surprise_mid",  label: "Surpresa",    ring: "mid" },
        { code: "surprise_low",  label: "Distra√ß√£o",   ring: "low" }
      ],
      sadness: [
        { code: "sadness_high",  label: "Ang√∫stia",    ring: "high" },
        { code: "sadness_mid",   label: "Tristeza",    ring: "mid" },
        { code: "sadness_low",   label: "T√©dio",       ring: "low" }
      ],
      disgust: [
        { code: "disgust_high",  label: "Repugn√¢ncia", ring: "high" },
        { code: "disgust_mid",   label: "Nojo",        ring: "mid" },
        { code: "disgust_low",   label: "Aborrecimento", ring: "low" }
      ],
      anger: [
        { code: "anger_high",    label: "Ira",         ring: "high" },
        { code: "anger_mid",     label: "Raiva",       ring: "mid" },
        { code: "anger_low",     label: "Irrita√ß√£o",   ring: "low" }
      ],
      anticipation: [
        { code: "anticipation_high", label: "Vigil√¢ncia",  ring: "high" },
        { code: "anticipation_mid",  label: "Antecipa√ß√£o", ring: "mid" },
        { code: "anticipation_low",  label: "Interesse",   ring: "low" }
      ]
    };

    const DIADS = [
      { code: "diad_love",         label: "Amor",          primaryA: "joy",         primaryB: "trust" },
      { code: "diad_submission",   label: "Submiss√£o",     primaryA: "trust",       primaryB: "fear" },
      { code: "diad_intimidation", label: "Intimida√ß√£o",   primaryA: "fear",        primaryB: "surprise" },
      { code: "diad_disapproval",  label: "Desaprova√ß√£o",  primaryA: "surprise",    primaryB: "sadness" },
      { code: "diad_remorse",      label: "Remorso",       primaryA: "sadness",     primaryB: "disgust" },
      { code: "diad_contempt",     label: "Menosprezo",    primaryA: "disgust",     primaryB: "anger" },
      { code: "diad_aggressivity", label: "Agressividade", primaryA: "anger",       primaryB: "anticipation" },
      { code: "diad_optimism",     label: "Otimismo",      primaryA: "anticipation", primaryB: "joy" }
    ];

    const PRIMARY_LABELS = {
      joy: "Alegria",
      trust: "Confian√ßa",
      fear: "Medo",
      surprise: "Surpresa",
      sadness: "Tristeza",
      disgust: "Nojo",
      anger: "Raiva",
      anticipation: "Antecipa√ß√£o"
    };

    const INFO_MAP = { /* === TODO: MESMO BLOCO INFO_MAP COMPLETO QUE VOC√ä J√Å TINHA AQUI === */
      /* para caber na resposta, n√£o repeti tudo; no seu arquivo final, mantenha o INFO_MAP
         exatamente como estava no c√≥digo que voc√™ enviou (sem altera√ß√µes) */
      /* ... cole aqui o mesmo INFO_MAP inteiro da sua vers√£o anterior ... */
    };

    function shadeColor(hex, percent) {
      let num = parseInt(hex.replace("#", ""), 16);
      let r = (num >> 16) + percent;
      let g = ((num >> 8) & 0x00FF) + percent;
      let b = (num & 0x0000FF) + percent;
      r = Math.max(Math.min(255, r), 0);
      g = Math.max(Math.min(255, g), 0);
      b = Math.max(Math.min(255, b), 0);
      return "#" + (b | (g << 8) | (r << 16)).toString(16).padStart(6, "0");
    }

    function formatDateTime(date) {
      const pad = (n) => String(n).padStart(2, "0");
      return `${pad(date.getDate())}/${pad(date.getMonth() + 1)}/${date.getFullYear()} ${pad(date.getHours())}:${pad(date.getMinutes())}`;
    }

    function truncate(text, max) {
      if (!text) return "";
      return text.length > max ? text.slice(0, max) + "‚Ä¶" : text;
    }

    function getCssVar(name) {
      const value = getComputedStyle(document.body).getPropertyValue(name);
      return (value || "").trim() || "#e5e7eb";
    }

    function buildWheel() {
      const svg = document.getElementById("emotionWheel");
      svg.innerHTML = "";

      const centerX = 0;
      const centerY = 0;
      const stepAngle = 45;
      const innerR = 35;
      const midR = 80;
      const outerR = 125;
      const diadInnerR = 140;
      const diadOuterR = 165;

      const degToRad = (deg) => (deg * Math.PI) / 180;

      function createWedge(rInner, rOuter, startDeg, endDeg, options) {
        const startRad = degToRad(startDeg);
        const endRad = degToRad(endDeg);

        const x1 = centerX + rInner * Math.cos(startRad);
        const y1 = centerY + rInner * Math.sin(startRad);
        const x2 = centerX + rInner * Math.cos(endRad);
        const y2 = centerY + rInner * Math.sin(endRad);
        const x3 = centerX + rOuter * Math.cos(endRad);
        const y3 = centerY + rOuter * Math.sin(endRad);
        const x4 = centerX + rOuter * Math.cos(startRad);
        const y4 = centerY + rOuter * Math.sin(startRad);

        const largeArcFlag = endDeg - startDeg <= 180 ? 0 : 1;

        const d = [
          "M", x1, y1,
          "A", rInner, rInner, 0, largeArcFlag, 1, x2, y2,
          "L", x3, y3,
          "A", rOuter, rOuter, 0, largeArcFlag, 0, x4, y4,
          "Z"
        ].join(" ");

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", d);
        path.setAttribute("fill", options.fill || "#ccc");
        path.setAttribute("class", "wheel-segment");
        path.setAttribute("tabindex", "0");
        path.setAttribute("role", "button");
        path.dataset.code = options.code;
        path.dataset.type = options.type;
        path.dataset.primary = options.primary || "";
        path.dataset.ring = options.ring || "";
        path.setAttribute("aria-label", options.ariaLabel || "");
        svg.appendChild(path);

        path.addEventListener("click", () => handleEmotionSelection(options.code));
        path.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter" || ev.key === " ") {
            ev.preventDefault();
            handleEmotionSelection(options.code);
          }
        });

        return { path, startDeg, endDeg, rInner, rOuter };
      }

      const dotted = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      dotted.setAttribute("cx", centerX);
      dotted.setAttribute("cy", centerY);
      dotted.setAttribute("r", (diadInnerR + diadOuterR) / 2);
      dotted.setAttribute("class", "wheel-dotted-circle");
      svg.appendChild(dotted);

      const allSegments = {};

      PRIMARIES.forEach((primary) => {
        const baseAngle = primary.angle;
        const width = stepAngle * 0.80;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = primary.colors;

        const intensities = INTENSITY_CONFIG[primary.key];

        intensities.forEach((item) => {
          let rin, rout, delta;
          if (item.ring === "high") {
            rin = innerR;
            rout = (innerR + midR) / 2;
            delta = -25;
          } else if (item.ring === "mid") {
            rin = (innerR + midR) / 2;
            rout = (midR + outerR) / 2;
            delta = 0;
          } else {
            rin = (midR + outerR) / 2;
            rout = outerR;
            delta = 20;
          }

          const fillColor = shadeColor(baseColor, delta);
          const seg = createWedge(
            rin,
            rout,
            start,
            end,
            {
              fill: fillColor,
              code: item.code,
              type: "primary",
              primary: primary.key,
              ring: item.ring,
              ariaLabel: item.label + " (" + PRIMARY_LABELS[primary.key] + ")"
            }
          );
          allSegments[item.code] = seg;

          const labelAngle = baseAngle;
          const labelRadius = (rin + rout) / 2;
          const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
          const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", lx);
          text.setAttribute("y", ly + 2);
          text.setAttribute("class", "wheel-label");
          text.textContent = item.label.toLowerCase();
          svg.appendChild(text);
        });
      });

      DIADS.forEach((diad, index) => {
        const primary = PRIMARIES[index];
        const baseAngle = primary.angle + stepAngle / 2;
        const width = stepAngle * 0.55;
        const start = baseAngle - width / 2;
        const end = baseAngle + width / 2;
        const baseColor = PRIMARIES[index].colors;
        const fillColor = shadeColor(baseColor, 25);

        const seg = createWedge(
          diadInnerR,
          diadOuterR,
          start,
          end,
          {
            fill: fillColor,
            code: diad.code,
            type: "diad",
            primary: diad.primaryA,
            ring: "diad",
            ariaLabel: diad.label
          }
        );
        allSegments[diad.code] = seg;

        const labelAngle = baseAngle;
        const labelRadius = (diadInnerR + diadOuterR) / 2;
        const lx = centerX + labelRadius * Math.cos(degToRad(labelAngle));
        const ly = centerY + labelRadius * Math.sin(degToRad(labelAngle));

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", lx);
        text.setAttribute("y", ly + 2);
        text.setAttribute("class", "wheel-label");
        text.textContent = diad.label.toLowerCase();
        svg.appendChild(text);
      });

      window._wheelSegments = allSegments;
    }

    let currentEmotionCode = null;
    let currentChart = null;
    const STORAGE_KEY = "plutchik_records_v1";

    function getRecords() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveRecords(records) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }

    function handleEmotionSelection(code) {
      const info = INFO_MAP[code];
      if (!info) return;

      currentEmotionCode = code;

      if (window._wheelSegments) {
        Object.values(window._wheelSegments).forEach(obj => obj.path.classList.remove("highlight"));
        const seg = window._wheelSegments[code];
        if (seg) seg.path.classList.add("highlight");
      }

      const card = document.getElementById("detailsCard");
      const primaryLabel = info.primary ? PRIMARY_LABELS[info.primary] : null;

      let levelText = "";
      if (info.type === "primary") {
        if (info.ring === "high") levelText = "Alta intensidade";
        else if (info.ring === "mid") levelText = "Intensidade m√©dia";
        else levelText = "Baixa intensidade";
      } else {
        levelText = "Combina√ß√£o de duas emo√ß√µes adjacentes (diade)";
      }

      let typeText = "";
      if (info.type === "primary" && primaryLabel) {
        typeText = "Emo√ß√£o b√°sica: " + primaryLabel;
      } else if (info.type === "diad" && info.primaries) {
        typeText = "Combina√ß√£o entre " + PRIMARY_LABELS[info.primaries[0]] + " e " + PRIMARY_LABELS[info.primaries[1]];
      }

      const createList = (items) => {
        if (!items || !items.length) return "";
        return "<ul class=\"details-list\">" + items.map(it => "<li>" + it + "</li>").join("") + "</ul>";
      };

      card.innerHTML = `
        <h3 class="details-emotion-name"><strong>${info.displayName}</strong></h3>
        <p class="details-emotion-meta">${levelText}${typeText ? " ‚Ä¢ " + typeText : ""}</p>
        <p class="details-block"><strong>Defini√ß√£o:</strong> ${info.definition}</p>
        <p class="details-block"><strong>Fun√ß√£o adaptativa:</strong> ${info.adaptive}</p>
        <p class="details-block"><strong>Situa√ß√µes em que costuma aparecer:</strong></p>
        ${createList(info.situations)}
        <p class="details-block"><strong>Quando a emo√ß√£o n√£o √© bem manejada:</strong></p>
        ${createList(info.risks)}
        <p class="details-block"><strong>Estrat√©gias de regula√ß√£o emocional:</strong></p>
        ${createList(info.strategies)}
        <p class="details-block"><strong>Perguntas para reflex√£o:</strong></p>
        ${createList(info.reflections)}
      `;

      const emotionInput = document.getElementById("selectedEmotion");
      let label = info.displayName;
      if (info.type === "primary" && primaryLabel) {
        label += " ‚Äì " + primaryLabel;
      }
      if (info.type === "diad" && info.primaries) {
        label += " (" + PRIMARY_LABELS[info.primaries[0]] + " + " + PRIMARY_LABELS[info.primaries[1]] + ")";
      }
      emotionInput.value = label;

      document.getElementById("registerButton").disabled = false;
    }

    function renderHistory() {
      const tbody = document.getElementById("historyBody");
      const emptyMsg = document.getElementById("historyEmptyMessage");
      const records = getRecords();

      tbody.innerHTML = "";

      if (!records.length) {
        emptyMsg.style.display = "block";
      } else {
        emptyMsg.style.display = "none";
      }

      records
        .slice()
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .forEach((rec) => {
          const tr = document.createElement("tr");
          const dateCell = document.createElement("td");
          const emotionCell = document.createElement("td");
          const intensityCell = document.createElement("td");
          const contextCell = document.createElement("td");

          dateCell.textContent = formatDateTime(new Date(rec.createdAt));
          emotionCell.textContent = rec.emotionLabel;
          intensityCell.textContent = rec.userIntensity;
          contextCell.textContent = truncate(rec.context || "", 120);

          tr.appendChild(dateCell);
          tr.appendChild(emotionCell);
          tr.appendChild(intensityCell);
          tr.appendChild(contextCell);
          tbody.appendChild(tr);
        });
    }

    function buildChart() {
      const ctx = document.getElementById("emotionChart").getContext("2d");
      const labels = [
        "Alegria",
        "Confian√ßa",
        "Medo",
        "Surpresa",
        "Tristeza",
        "Nojo",
        "Raiva",
        "Antecipa√ß√£o"
      ];
      const textColor = getCssVar("--text-main");
      const accent = getCssVar("--accent") || "#f97316";
      const accentSoft = getCssVar("--accent-soft") || "rgba(249, 115, 22, 0.5)";

      currentChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Registros",
            data: new Array(labels.length).fill(0),
            borderWidth: 1,
            backgroundColor: accentSoft,
            borderColor: accent
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              ticks: { color: textColor },
              grid: { display: false }
            },
            y: {
              ticks: { color: textColor },
              grid: { color: "rgba(148, 163, 184, 0.3)" },
              beginAtZero: true,
              precision: 0
            }
          },
          plugins: {
            legend: {
              labels: {
                color: textColor
              }
            }
          }
        }
      });

      updateChart();
    }

    function updateChartColors() {
      if (!currentChart) return;
      const textColor = getCssVar("--text-main");
      const gridColor = document.body.dataset.theme === "light"
        ? "rgba(148, 163, 184, 0.35)"
        : "rgba(148, 163, 184, 0.55)";

      currentChart.options.scales.x.ticks.color = textColor;
      currentChart.options.scales.y.ticks.color = textColor;
      if (currentChart.options.scales.x.grid) {
        currentChart.options.scales.x.grid.color = gridColor;
      }
      if (currentChart.options.scales.y.grid) {
        currentChart.options.scales.y.grid.color = gridColor;
      }
      if (currentChart.options.plugins && currentChart.options.plugins.legend && currentChart.options.plugins.legend.labels) {
        currentChart.options.plugins.legend.labels.color = textColor;
      }
      currentChart.update();
    }

    function updateChart() {
      if (!currentChart) return;
      const records = getRecords();
      const counts = {
        joy: 0,
        trust: 0,
        fear: 0,
        surprise: 0,
        sadness: 0,
        disgust: 0,
        anger: 0,
        anticipation: 0
      };

      records.forEach((rec) => {
        if (rec.type === "primary" && rec.primaryKey) {
          counts[rec.primaryKey] = (counts[rec.primaryKey] || 0) + 1;
        } else if (rec.type === "diad" && rec.primaries) {
          rec.primaries.forEach((p) => {
            counts[p] = (counts[p] || 0) + 0.5;
          });
        }
      });

      currentChart.data.datasets[0].data = [
        counts.joy,
        counts.trust,
        counts.fear,
        counts.surprise,
        counts.sadness,
        counts.disgust,
        counts.anger,
        counts.anticipation
      ];
      currentChart.update();
    }

    function handleFormSubmit(event) {
      event.preventDefault();
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de registrar.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const userIntensity = document.getElementById("userIntensity").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      const now = new Date();
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;

      const record = {
        id: now.getTime(),
        createdAt: now.toISOString(),
        patientName: name,
        patientAge: age,
        patientDate: recordDate || null,
        emotionCode: currentEmotionCode,
        emotionLabel,
        type: info.type,
        ring: info.ring || "diad",
        primaryKey: info.primary || null,
        primaries: info.primaries || null,
        userIntensity,
        context,
        triggers,
        behaviors,
        desired
      };

      const records = getRecords();
      records.push(record);
      saveRecords(records);

      renderHistory();
      updateChart();

      alert("Registro salvo localmente com sucesso.");
    }

    function handleDownloadPdf() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        alert("Selecione uma emo√ß√£o na roda antes de gerar o PDF.");
        return;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const triggers = document.getElementById("triggersInput").value.trim();
      const behaviors = document.getElementById("behaviorsInput").value.trim();
      const desired = document.getElementById("desiredInput").value.trim();

      const now = new Date();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "mm", "a4");

      const margin = 15;
      let y = 18;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text("Registro Emocional ‚Äì Roda de Plutchik", margin, y);
      y += 10;

      doc.setFontSize(12);
      doc.text("Dados principais", margin, y);
      y += 6;

      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");

      const dateRefLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const typeLabel = info.type === "primary"
        ? "Emo√ß√£o prim√°ria"
        : "Combina√ß√£o (diade)";

      let levelLabel;
      if (info.type === "primary") {
        if (info.ring === "high") levelLabel = "Alta intensidade";
        else if (info.ring === "mid") levelLabel = "Intensidade m√©dia";
        else levelLabel = "Baixa intensidade";
      } else {
        levelLabel = "Combina√ß√£o de duas emo√ß√µes adjacentes";
      }

      const dadosPrincipais = [
        "Nome do paciente: " + (name || "________________________"),
        "Idade: " + (age || "____"),
        "Data/hora de gera√ß√£o: " + formatDateTime(now),
        "Data de refer√™ncia do registro: " + dateRefLabel,
        "Emo√ß√£o selecionada: " + emotionLabel,
        "Tipo: " + typeLabel,
        "Intensidade na roda: " + levelLabel + " | Intensidade percebida: " + userIntensity
      ];

      dadosPrincipais.forEach((line) => {
        doc.text(line, margin, y);
        y += 5;
      });

      y += 2;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("Bloco psicoeducativo", margin, y);
      y += 6;

      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");

      doc.text("Defini√ß√£o:", margin, y);
      y += 5;
      const defWrapped = doc.splitTextToSize(info.definition, 180);
      doc.text(defWrapped, margin + 4, y, { maxWidth: 180, align: "justify" });
      y += defWrapped.length * 4 + 3;

      doc.text("Fun√ß√£o adaptativa:", margin, y);
      y += 5;
      const adapWrapped = doc.splitTextToSize(info.adaptive, 180);
      doc.text(adapWrapped, margin + 4, y, { maxWidth: 180, align: "justify" });
      y += adapWrapped.length * 4 + 4;

      doc.setFont("helvetica", "bold");
      doc.text("Principais riscos de manejo desadaptativo:", margin, y);
      y += 5;
      doc.setFont("helvetica", "normal");
      const riscosText = (info.risks || []).map(r => "‚Ä¢ " + r).join(" ");
      const riscosWrapped = doc.splitTextToSize(riscosText || "‚Äì", 180);
      doc.text(riscosWrapped, margin + 4, y, { maxWidth: 180, align: "justify" });
      y += riscosWrapped.length * 4 + 4;

      const tableBody = [
        ["Contexto emocional", context || "-"],
        ["Gatilhos percebidos", triggers || "-"],
        ["O que fez (respostas comportamentais)", behaviors || "-"],
        ["Como gostaria de ter reagido", desired || "-"]
      ];

      doc.autoTable({
        startY: y,
        head: [["Campo", "Conte√∫do"]],
        body: tableBody,
        styles: { font: "helvetica", fontSize: 10, cellPadding: 3, valign: "top" },
        headStyles: { fillColor: [15, 23, 42], textColor: 255 },
        columnStyles: {
          0: { cellWidth: 60 },
          1: { cellWidth: 120 }
        },
        margin: { left: margin, right: margin }
      });

      let finalY = doc.lastAutoTable.finalY || y + 10;
      finalY += 8;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("Orienta√ß√µes gerais e espa√ßo para anota√ß√µes", margin, finalY);
      finalY += 6;

      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      const closingText = doc.splitTextToSize(
        "Este registro √© um ponto de partida para a conversa em psicoterapia. " +
        "Use este material para identificar padr√µes, aprofundar reflex√µes e planejar respostas mais alinhadas aos seus valores. " +
        "Abaixo, h√° espa√ßo para anota√ß√µes futuras do paciente e do psic√≥logo:",
        180
      );
      doc.text(closingText, margin, finalY, { maxWidth: 180, align: "justify" });
      finalY += closingText.length * 4 + 4;

      for (let i = 0; i < 5; i++) {
        doc.line(margin, finalY, 210 - margin, finalY);
        finalY += 6;
      }

      doc.setFontSize(9);
      doc.setFont("helvetica", "italic");
      const footerText = "Richelmy Murta ‚Äì Psic√≥logo Cl√≠nico. Ferramenta psicoeducativa baseada na Roda das Emo√ß√µes de Plutchik.";
      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const footerY = pageHeight - 10;
      doc.text(footerText, pageWidth / 2, footerY, { align: "center" });

      doc.save("registro-emocional-plutchik.pdf");
    }

    function buildWhatsappSummary() {
      if (!currentEmotionCode || !INFO_MAP[currentEmotionCode]) {
        return null;
      }

      const info = INFO_MAP[currentEmotionCode];
      const emotionLabelInput = document.getElementById("selectedEmotion").value.trim();
      const emotionLabel = emotionLabelInput || info.displayName;
      const userIntensity = document.getElementById("userIntensity").value;
      const name = document.getElementById("patientName").value.trim();
      const age = document.getElementById("patientAge").value.trim();
      const recordDate = document.getElementById("recordDate").value;
      const context = document.getElementById("contextInput").value.trim();
      const now = new Date();

      const dateLabel = recordDate
        ? recordDate.split("-").reverse().join("/")
        : formatDateTime(now).split(" ")[0];

      const shortContext = truncate(context || "", 200);

      const textPlain =
        "Registro emocional ‚Äì Roda de Plutchik\n" +
        "Paciente: " + (name || "-") + (age ? " (" + age + " anos)" : "") + "\n" +
        "Data de refer√™ncia: " + dateLabel + "\n" +
        "Emo√ß√£o: " + emotionLabel + "\n" +
        "Intensidade percebida: " + userIntensity + "\n" +
        "Resumo do contexto: " + (shortContext || "-") + "\n\n" +
        "Mensagem gerada pela ferramenta cl√≠nica de registro emocional.";

      return textPlain;
    }

    function handleShareWhatsapp() {
      const textPlain = buildWhatsappSummary();
      if (!textPlain) {
        alert("Selecione uma emo√ß√£o na roda antes de enviar o resumo.");
        return;
      }
      const url = "https://wa.me/?text=" + encodeURIComponent(textPlain);
      window.open(url, "_blank");
    }

    function handleSendPsychologistWhatsapp() {
      const textPlain = buildWhatsappSummary();
      if (!textPlain) {
        alert("Selecione uma emo√ß√£o na roda antes de enviar o resumo ao psic√≥logo.");
        return;
      }
      const url = "https://wa.me/5535984640729?text=" + encodeURIComponent(textPlain);
      window.open(url, "_blank");
    }

    function handleSharePageWhatsapp() {
      const pageUrl = "https://ricmurtapsicologia.github.io/rodaemo-oes/";
      const textPlain =
        "Quero te mostrar esta ferramenta cl√≠nica baseada na Roda das Emo√ß√µes de Plutchik. " +
        "Ela ajuda a reconhecer, entender e registrar emo√ß√µes com psicoeduca√ß√£o, gr√°fico e PDF.\n\n" +
        "Voc√™ pode acessar por aqui: " + pageUrl;
      const url = "https://wa.me/?text=" + encodeURIComponent(textPlain);
      window.open(url, "_blank");
    }

    function applyTheme(theme) {
      const body = document.body;
      const icon = document.getElementById("themeIcon");
      const label = document.getElementById("themeLabel");

      if (theme === "light") {
        body.dataset.theme = "light";
        icon.textContent = "‚òÄÔ∏è";
        label.textContent = "Tema claro";
      } else {
        body.dataset.theme = "dark";
        icon.textContent = "üåô";
        label.textContent = "Tema escuro";
      }
      localStorage.setItem("plutchik_theme", theme);
      updateChartColors();
    }

    function initTheme() {
      const saved = localStorage.getItem("plutchik_theme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        applyTheme("dark");
      }

      const btn = document.getElementById("themeToggle");
      btn.addEventListener("click", () => {
        const next = document.body.dataset.theme === "light" ? "dark" : "light";
        applyTheme(next);
      });
    }

    function showOnboarding() {
      const overlay = document.getElementById("onboardingOverlay");
      const startButton = document.getElementById("onboardingStartButton");
      overlay.hidden = false;
      overlay.setAttribute("aria-hidden", "false");
      startButton.focus();
    }

    function hideOnboarding() {
      const overlay = document.getElementById("onboardingOverlay");
      overlay.hidden = true;
      overlay.setAttribute("aria-hidden", "true");
    }

    function initOnboarding() {
      const seen = localStorage.getItem("plutchik_onboarding_seen");
      const startButton = document.getElementById("onboardingStartButton");
      const laterButton = document.getElementById("onboardingLaterButton");
      const howToButton = document.getElementById("howToUseButton");
      const overlay = document.getElementById("onboardingOverlay");

      if (!seen) {
        showOnboarding();
      }

      startButton.addEventListener("click", () => {
        localStorage.setItem("plutchik_onboarding_seen", "1");
        hideOnboarding();
      });

      laterButton.addEventListener("click", () => {
        hideOnboarding();
      });

      howToButton.addEventListener("click", (e) => {
        e.preventDefault();
        overlay.hidden ? showOnboarding() : hideOnboarding();
      });

      document.addEventListener("keydown", (ev) => {
        if (ev.key === "Escape" && !overlay.hidden) {
          hideOnboarding();
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("footerYear").textContent = new Date().getFullYear();

      const today = new Date();
      const isoToday = today.toISOString().slice(0, 10);
      document.getElementById("recordDate").value = isoToday;

      initTheme();
      buildWheel();
      renderHistory();
      buildChart();
      initOnboarding();

      document.getElementById("emotionForm").addEventListener("submit", handleFormSubmit);
      document.getElementById("downloadPdfButton").addEventListener("click", handleDownloadPdf);
      document.getElementById("shareWhatsappButton").addEventListener("click", handleShareWhatsapp);
      document.getElementById("sendPsychologistWhatsappButton").addEventListener("click", handleSendPsychologistWhatsapp);
      document.getElementById("sharePageButton").addEventListener("click", handleSharePageWhatsapp);
      document.getElementById("clearHistoryButton").addEventListener("click", () => {
        if (confirm("Deseja realmente apagar todo o hist√≥rico deste navegador?")) {
          saveRecords([]);
          renderHistory();
          updateChart();
        }
      });
    });
  </script>
</body>
</html>

